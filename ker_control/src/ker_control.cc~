#include <ker_control.h>

void Ker::setJoint(std::vector<float> joint_goal)
{
  std_msgs::Float64MultiArray leg_joints, shoulder_joints;

  joint_goal.resize(NUM_JOINTS);
  for (int i = 0; i<NUM_JOINTS_SHOULDER; i++)
    {
      shoulder_joints.data.push_back(joint_goal[i]);
    }
  shoulder_pub.publish(shoulder_joints);

  for (int i = NUM_JOINTS_SHOULDER; i<NUM_JOINTS; i++)
    {
      leg_joints.data.push_back(joint_goal[i]);
    }
  leg_pub.publish(leg_joints);
}

// Banalan primjer periodičkog kretanja zglobova
void Ker::walkingGait(std::vector<float> &goal, int i)
{
  goal.resize(NUM_JOINTS);
  double T=100;
  ROS_INFO_STREAM(2*PI*double(i/T));
  goal[0] = 0;
  goal[1] = 0;
  goal[2] = 0;
  goal[3] = 0;

  goal[4] = sin(2*PI*double(i/T));
  goal[5] = sin(2*PI*double(i/T) - PI/4);

  goal[6] = sin(2*PI*double(i/T) + PI);
  goal[7] = sin(2*PI*double(i/T) + PI -PI/4);

  goal[8] = 0*sin(2*PI*double(i/T) + 3*PI/2);
  goal[9] = 0*sin(2*PI*double(i/T) + 3*PI/2 - PI/4);

  goal[10] = 0*sin(2*PI*double(i/T) + PI/2);
  goal[11] = 0*sin(2*PI*double(i/T) + PI/2 - PI/4);
}

/*void Ker::legIK(geometry_msgs::Point pnt)
{

}*/

int main(int argc, char** argv)
{
  ros::init(argc, argv, "ker_control");
  ros::NodeHandle n;
  ros::Rate r(50);

  Ker ker(n);
  ROS_INFO_STREAM("Control node successfully initialized!");

  std::vector<float> goal(NUM_JOINTS);
  int i = 0;
  while(ros::ok())
    {
      ker.walkingGait(goal, i);
      ker.setJoint(goal);
      i++;
      ros::spinOnce();
      r.sleep();
    }
}

