<?xml version='1.0'?>
  <robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="ker">

    <xacro:property name="bodywidth" value=".12" />
    <xacro:property name="bodylen" value=".20" />
    <xacro:property name="bodyheight" value=".031" />

    <xacro:property name="motorwidth" value=".025" />
    <xacro:property name="motorlen" value=".022" />
    <xacro:property name="motorheight" value=".037" />

    <xacro:property name="bigmotorwidth" value=".025" />
    <xacro:property name="bigmotorlen" value=".051" />
    <xacro:property name="bigmotorheight" value=".053" />

    <xacro:property name="humeruswidth" value=" 0.025" />
    <xacro:property name="humeruslen" value="0.022" />
    <xacro:property name="humerusheight" value=" 0.076" />

    <xacro:property name="femurwidth" value=" 0.025" />
    <xacro:property name="femurlen" value="0.022" />
    <xacro:property name="femurheight" value="0.076" />

    <xacro:property name="radiuswidth" value="0.025" />
    <xacro:property name="radiuslen" value="0.022" />
    <xacro:property name="radiusheight" value="0.08" />

    <xacro:property name="tibulawidth" value="0.025" />
    <xacro:property name="tibulalen" value="0.022" />
    <xacro:property name="tibulaheight" value="0.08" />

    <!--TRANSMISSION-->
    <xacro:macro name="ker_transmission" params="joint_name">
      <transmission name="${joint_name}_transmission">
        <type>transmission_interface/SimpleTransmission</type>
          <joint name="${joint_name}">
            <hardwareInterface>VelocityJointInterface</hardwareInterface>
          </joint>
          <actuator name="${joint_name}_motor">
            <mechanicalReduction>1</mechanicalReduction>
          </actuator>
      </transmission>
	</xacro:macro>

    <!--DEFAULT INERTIAL PARAMETERS-->
    <xacro:macro name="default_inertial" params="mass">
        <inertial>
                <mass value="${mass}" />
                <inertia ixx="1.0" ixy="0.0" ixz="0.0"
                     iyy="1.0" iyz="0.0"
                     izz="1.0" />
        </inertial>
    </xacro:macro>

    <!--JOINT OPTION PRESETS-->
    <xacro:macro name="fixed" params="name pname origin">
        <joint name="${name}_joint" type="fixed">
            <parent link="${pname}"/>
            <child link="${name}"/>
            <origin xyz="${origin}" rpy="0 0 0"/>
        </joint>
    </xacro:macro>

    <xacro:macro name="revolute" params="name pname origin axis">
        <joint name="${name}_joint" type="revolute">
            <parent link="${pname}"/>
            <child link="${name}"/>
            <origin xyz="${origin}" rpy="0 0 0"/>
            <axis xyz="${axis}"/>
            <dynamics damping="0.1" friction="0.1"/>
            <limit effort="3.0" velocity="3.0" lower="0.0" upper="0.0"/>
        </joint>
    </xacro:macro>

    <!--MOTOR (CORONA)-->
    <xacro:macro name="bigmotor" params="name pname origin">
    <link name="${name}">
        <xacro:default_inertial mass="0.5"/>
        <visual>
            <geometry>
              <box size="${bigmotorlen} ${bigmotorwidth} ${bigmotorheight}"/>
            </geometry>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <material name="blue">
                <color rgba="0 0 .8 1"/>
            </material>
        </visual>
        <collision>
            <geometry>
              <box size="${bigmotorlen} ${bigmotorwidth} ${bigmotorheight}"/>
            </geometry>
            <origin xyz="0 0 0" rpy="0 0 0"/>
        </collision>
    </link>
    <joint name="${name}_joint" type="fixed">
        <parent link="${pname}"/>
        <child link="${name}"/>
        <origin xyz="${origin}" rpy="0 0 0"/>
    </joint>
    </xacro:macro>

    <!--MOTOR (DYNAMIXEL)-->
    <xacro:macro name="motor" params="name *type">
    <link name="${name}">
        <xacro:default_inertial mass="0.5"/>
        <visual>
            <geometry>
              <box size="${motorlen} ${motorwidth} ${motorheight}"/>
            </geometry>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <material name="blue">
                <color rgba="0 0 .8 1"/>
            </material>
        </visual>
        <collision>
            <geometry>
              <box size="${motorlen} ${motorwidth} ${motorheight}"/>
            </geometry>
            <origin xyz="0 0 0" rpy="0 0 0"/>
        </collision>
    </link>
    <xacro:insert_block name="type" /> 
    </xacro:macro>

    <!--HUMERUS-->
    <xacro:macro name="humerus" params="name *type">
    <link name="${name}">
        <xacro:default_inertial mass="2"/>
        <collision>
          <origin xyz="0 0 ${-motorheight/2-humerusheight/2}" rpy="0 0 0"/>
          <geometry>
            <box size="${humeruslen} ${humeruswidth} ${humerusheight}"/>
          </geometry>
        </collision>
        <visual>
          <origin xyz="0 0 ${-motorheight/2-humerusheight/2}" rpy="0 0 0"/>
          <geometry>
            <box size = "${humeruslen} ${humeruswidth} ${humerusheight}"/>
          </geometry>
        </visual>
    </link>
    <xacro:insert_block name="type" />
    <xacro:ker_transmission joint_name="${name}_joint" /> 
    </xacro:macro>

    <!--FEMUR-->
    <xacro:macro name="femur" params="name *type">
    <link name="${name}">
        <xacro:default_inertial mass="2"/>
        <collision>
          <origin xyz="0 0 ${-motorheight/2-femurheight/2}" rpy="0 0 0"/>
          <geometry>
            <box size="${femurlen} ${femurwidth} ${femurheight}"/>
          </geometry>
        </collision>
        <visual>
          <origin xyz="0 0 ${-motorheight/2-femurheight/2}" rpy="0 0 0"/>
          <geometry>
            <box size = "${femurlen} ${femurwidth} ${femurheight}"/>
          </geometry>
        </visual>
    </link>
    <xacro:insert_block name="type" />
    <xacro:ker_transmission joint_name="${name}_joint" /> 
    </xacro:macro>

    <!--RADIUS-->
    <xacro:macro name="radius" params="name *type">
    <link name="${name}">
        <xacro:default_inertial mass="2"/>
        <collision>
          <origin xyz="0 0 ${-motorheight/2-femurheight/2}" rpy="0 0 0"/>
          <geometry>
            <box size="${radiuslen} ${radiuswidth} ${radiusheight}"/>
          </geometry>
        </collision>
        <visual>
          <origin xyz="0 0 ${-motorheight/2-radiusheight/2}" rpy="0 0 0"/>
          <geometry>
            <box size = "${radiuslen} ${radiuswidth} ${radiusheight}"/>
          </geometry>
        </visual>
    </link>
    <xacro:insert_block name="type" />
    <xacro:ker_transmission joint_name="${name}_joint" /> 
    </xacro:macro>

    <!--TIBULA-->
    <xacro:macro name="tibula" params="name *type">
    <link name="${name}">
        <xacro:default_inertial mass="2"/>
        <collision>
          <origin xyz="0 0 ${-motorheight/2-tibulaheight/2}" rpy="0 0 0"/>
          <geometry>
            <box size="${tibulalen} ${tibulawidth} ${tibulaheight}"/>
          </geometry>
        </collision>
        <visual>
          <origin xyz="0 0 ${-motorheight/2-tibulaheight/2}" rpy="0 0 0"/>
          <geometry>
            <box size = "${tibulalen} ${tibulawidth} ${tibulaheight}"/>
          </geometry>
        </visual>
    </link>
    <xacro:insert_block name="type" />
    <xacro:ker_transmission joint_name="${name}_joint" /> 
    </xacro:macro>

    <!--BODY-->
    <link name="body">
        <xacro:default_inertial mass="10"/>

        <collision>
          <origin xyz="0 0 0.0" rpy="0 0 0"/>
          <geometry>
            <box size="${bodylen} ${bodywidth} ${bodyheight}"/>
          </geometry>
        </collision>

        <visual>
          <origin xyz="0 0 0.0" rpy="0 0 0"/>
          <geometry>
            <box size = "${bodylen} ${bodywidth} ${bodyheight}"/>
          </geometry>
        </visual>
    </link>

    <!--EXECUTE MACROS-->
    <xacro:bigmotor name="big_motor_1" pname="body" origin="${bodylen/2-bigmotorlen/2} ${bodywidth/2+bigmotorwidth/2} ${-bigmotorheight/2+bodyheight/2}" />
    <xacro:bigmotor name="big_motor_2" pname="body" origin="${bodylen/2-bigmotorlen/2} ${-bodywidth/2-bigmotorwidth/2} ${-bigmotorheight/2+bodyheight/2}" />
    <xacro:bigmotor name="big_motor_3" pname="body" origin="${-bodylen/2+bigmotorlen/2} ${-bodywidth/2-bigmotorwidth/2} ${-bigmotorheight/2+bodyheight/2}" />
    <xacro:bigmotor name="big_motor_4" pname="body" origin="${-bodylen/2+bigmotorlen/2} ${bodywidth/2+bigmotorwidth/2} ${-bigmotorheight/2+bodyheight/2}" />

    <xacro:motor name="motor_1"> 
        <xacro:revolute name="motor_1" pname="big_motor_1" origin="${bigmotorlen/2+motorlen/2} 0 0" axis="1 0 0"/> 
    </xacro:motor>
    <xacro:ker_transmission joint_name="motor_1_joint" />  
    <xacro:motor name="motor_2"> 
        <xacro:revolute name="motor_2" pname="big_motor_2" origin="${bigmotorlen/2+motorlen/2} 0 0" axis="1 0 0"/> 
    </xacro:motor>
    <xacro:ker_transmission joint_name="motor_2_joint" /> 
    <xacro:motor name="motor_3"> 
        <xacro:revolute name="motor_3" pname="big_motor_3" origin="${bigmotorlen/2+motorlen/2} 0 0" axis="1 0 0"/> 
    </xacro:motor>
    <xacro:ker_transmission joint_name="motor_3_joint" /> 
    <xacro:motor name="motor_4"> 
        <xacro:revolute name="motor_4" pname="big_motor_4" origin="${bigmotorlen/2+motorlen/2} 0 0" axis="1 0 0"/> 
    </xacro:motor>
    <xacro:ker_transmission joint_name="motor_4_joint" /> 

    <xacro:humerus name="humerus_1">
        <xacro:revolute name="humerus_1" pname="motor_1" origin="0 0 0" axis="0 1 0"/> 
    </xacro:humerus>
    <xacro:humerus name="humerus_2">
        <xacro:revolute name="humerus_2" pname="motor_2" origin="0 0 0" axis="0 -1 0"/> 
    </xacro:humerus>
    <xacro:femur name="femur_2">
        <xacro:revolute name="femur_2" pname="motor_3" origin="0 0 0" axis="0 -1 0"/> 
    </xacro:femur>
    <xacro:femur name="femur_1">
        <xacro:revolute name="femur_1" pname="motor_4" origin="0 0 0" axis="0 1 0"/> 
    </xacro:femur>

    <xacro:motor name="motor_1b"> 
        <xacro:fixed name="motor_1b" pname="humerus_1" origin="0 0 -${humerusheight}" /> 
    </xacro:motor>
    <xacro:motor name="motor_2b"> 
        <xacro:fixed name="motor_2b" pname="humerus_2" origin="0 0 -${humerusheight}" /> 
    </xacro:motor>
    <xacro:motor name="motor_3b"> 
        <xacro:fixed name="motor_3b" pname="femur_2" origin="0 0 -${femurheight}" /> 
    </xacro:motor>
    <xacro:motor name="motor_4b"> 
        <xacro:fixed name="motor_4b" pname="femur_1" origin="0 0 -${femurheight}" /> 
    </xacro:motor>

        <xacro:radius name="radius_1" >
        <xacro:revolute name="radius_1" pname="motor_1b" origin="0 0 0" axis="0 1 0"/> 
    </xacro:radius>
    <xacro:radius name="radius_2" >
        <xacro:revolute name="radius_2" pname="motor_2b" origin="0 0 0" axis="0 -1 0"/> 
    </xacro:radius>
    <xacro:tibula name="tibula_2" >
        <xacro:revolute name="tibula_2" pname="motor_3b" origin="0 0 0" axis="0 -1 0"/> 
    </xacro:tibula>
    <xacro:tibula name="tibula_1" >
        <xacro:revolute name="tibula_1" pname="motor_4b" origin="0 0 0" axis="0 1 0"/> 
    </xacro:tibula>
 

    <gazebo>
        <plugin filename="libgazebo_ros_control.so" name="gazebo_ros_control">
                <robotParam>robot_description</robotParam>
        </plugin>
    </gazebo>
  </robot>
